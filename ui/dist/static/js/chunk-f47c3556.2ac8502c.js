(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f47c3556"],{"0d9f":function(e,t,o){},6265:function(e,t,o){"use strict";o.r(t);var l=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("clusterbar",{attrs:{titleName:e.titleName,nameFunc:e.nameSearch,createFunc:e.createRoleDialog,createDisplay:"创建角色"}},[o("el-button",{attrs:{slot:"right-btn",size:"small",plain:"",type:""},on:{click:function(t){e.permissionListVisible=!0}},slot:"right-btn"},[e._v(" 权限列表 ")])],1),o("div",{ref:"tableCot",staticClass:"dashboard-container"},[o("el-table",{ref:"multipleTable",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.roles,"cell-style":e.cellStyle,"tooltip-effect":"dark","default-sort":{prop:"name"}}},[o("el-table-column",{attrs:{type:"selection",width:"45"}}),o("el-table-column",{attrs:{prop:"name",label:"角色",width:"150","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"description",label:"描述","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{prop:"create_time",label:"创建时间",width:"300","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[["admin","edit","view"].indexOf(t.row.name)<0?o("el-dropdown",{attrs:{size:"medium"}},[o("el-link",{attrs:{underline:!1}},[o("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em"},attrs:{"icon-class":"operate"}})],1),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.$updatePerm()?o("el-dropdown-item",{nativeOn:{click:function(o){o.preventDefault(),e.setPermCheck(t.row),e.updateRoleForm=!0,e.createRoleFormVisible=!0}}},[o("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em","line-height":"40px","vertical-align":"-0.25em"},attrs:{"icon-class":"edit"}}),o("span",{staticStyle:{"margin-left":"5px"}},[e._v("修改")])],1):e._e(),e.$deletePerm()?o("el-dropdown-item",{nativeOn:{click:function(o){return o.preventDefault(),e.deleteRoles([{name:t.row.name}])}}},[o("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em","line-height":"40px","vertical-align":"-0.25em"},attrs:{"icon-class":"delete"}}),o("span",{staticStyle:{"margin-left":"5px"}},[e._v("删除")])],1):e._e()],1)],1):e._e()]}}])})],1)],1),o("el-dialog",{attrs:{title:e.updateRoleForm?"修改角色":"创建角色",visible:e.createRoleFormVisible,"destroy-on-close":!0,top:"5vh"},on:{"update:visible":function(t){e.createRoleFormVisible=t},close:function(t){e.clearPermCheck(),e.updateRoleForm=!1,e.createRoleFormVisible=!1,e.form={name:"",description:""}}}},[o("el-form",{attrs:{model:e.form,"label-width":"80px","label-position":"left"}},[o("el-form-item",{attrs:{label:"角色名"}},[o("el-input",{attrs:{disabled:e.updateRoleForm,autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),o("el-form-item",{attrs:{label:"描述"}},[o("el-input",{attrs:{autocomplete:"off",placeholder:""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),e.permissions.length>0?o("el-table",{ref:"rolePermTable",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.permissions,"cell-style":e.cellStyle,"tooltip-effect":"dark",height:e.maxHeight-220}},[o("el-table-column",{attrs:{prop:"name",label:"对象","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"权限",align:"center"}},[o("el-table-column",{attrs:{label:"查询"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.operations.indexOf("get")>=0?[o("el-checkbox",{attrs:{checked:e.permCheck[t.row.scope][t.row.object]["get"]},on:{change:function(o){return e.rolePermChange(t.row,"get")}}})]:e._e()]}}],null,!1,2460639807)}),o("el-table-column",{attrs:{label:"创建"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.operations.indexOf("create")>=0?o("el-checkbox",{attrs:{checked:e.permCheck[t.row.scope][t.row.object]["create"]},on:{change:function(o){return e.rolePermChange(t.row,"create")}}}):e._e()]}}],null,!1,4052883755)}),o("el-table-column",{attrs:{label:"更新"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.operations.indexOf("update")>=0?o("el-checkbox",{attrs:{checked:e.permCheck[t.row.scope][t.row.object]["update"]},on:{change:function(o){return e.rolePermChange(t.row,"update")}}}):e._e()]}}],null,!1,2965985438)}),o("el-table-column",{attrs:{label:"删除"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.operations.indexOf("delete")>=0?o("el-checkbox",{attrs:{checked:e.permCheck[t.row.scope][t.row.object]["delete"]},on:{change:function(o){return e.rolePermChange(t.row,"delete")}}}):e._e()]}}],null,!1,1370784438)})],1)],1):e._e(),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.createRoleFormVisible=!1}}},[e._v("取 消")]),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.updateRoleForm?e.handleUpdateRole():e.handleCreateRole()}}},[e._v("确 定")])],1)],1),o("el-dialog",{attrs:{title:"权限列表",visible:e.permissionListVisible,top:"5vh"},on:{"update:visible":function(t){e.permissionListVisible=t}}},[o("el-table",{ref:"permTable",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.permissions,"cell-style":e.cellStyle,height:e.maxHeight-80,"tooltip-effect":"dark"}},[o("el-table-column",{attrs:{prop:"name",label:"对象","show-overflow-tooltip":""}}),o("el-table-column",{attrs:{label:"权限",align:"center"}},[o("el-table-column",{attrs:{label:"查询"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.operations.indexOf("get")>=0?o("i",{staticClass:"el-icon-check"}):e._e()]}}])}),o("el-table-column",{attrs:{label:"创建"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.operations.indexOf("create")>=0?o("i",{staticClass:"el-icon-check"}):e._e()]}}])}),o("el-table-column",{attrs:{label:"更新"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.operations.indexOf("update")>=0?o("i",{staticClass:"el-icon-check"}):e._e()]}}])}),o("el-table-column",{attrs:{label:"删除"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.operations.indexOf("delete")>=0?o("i",{staticClass:"el-icon-check"}):e._e()]}}])})],1)],1)],1)],1)},r=[],n=(o("a4d3"),o("e01a"),o("b0c0"),o("b85c")),a=o("61b2"),i=o("e287"),s=o("5c96"),c={name:"settings_role",components:{Clusterbar:a["a"]},created:function(){this.handleGetRoles(),this.handleGetPermissions()},mounted:function(){var e=this;window.onresize=function(){return function(){var t=window.innerHeight-150;e.maxHeight=t}()}},data:function(){return{maxHeight:window.innerHeight-150,cellStyle:{border:0},test:!0,titleName:["角色管理"],createRoleFormVisible:!1,updateRoleForm:!1,form:{name:"",description:""},formLabelWidth:"120px",roles:[],userData:[],search_name:"",permissionListVisible:!1,permissions:[],permCheck:{}}},methods:{handleGetRoles:function(){var e=this,t={};this.search_name&&(t["name"]=this.search_name),Object(i["f"])(t).then((function(t){e.roles=t.data}))},rolePermChange:function(e,t){this.permCheck[e.scope][e.object][t]=!this.permCheck[e.scope][e.object][t]},handleEdit:function(e,t){console.log(e,t)},handleCreateRole:function(){var e=this;if(this.form.name)if(this.form.description){var t=[];for(var o in this.permCheck)for(var l in this.permCheck[o]){var r=[];for(var n in this.permCheck[o][l])this.permCheck[o][l][n]&&r.push(n);r.length>0&&t.push({scope:o,object:l,operations:r})}var a={name:this.form.name,description:this.form.description,permissions:t};Object(i["b"])(a).then((function(){e.handleGetRoles(),e.createRoleFormVisible=!1,e.clearPermCheck(),s["Message"].success("创建成功")})).catch((function(t){console.log(t),e.clearPermCheck()}))}else s["Message"].error("请输入角色描述");else s["Message"].error("请输入角色名")},handleUpdateRole:function(){var e=this;if(this.form.name)if(this.form.description){var t=[];for(var o in this.permCheck)for(var l in this.permCheck[o]){var r=[];for(var n in this.permCheck[o][l])this.permCheck[o][l][n]&&r.push(n);r.length>0&&t.push({scope:o,object:l,operations:r})}var a={name:this.form.name,description:this.form.description,permissions:t};Object(i["j"])(this.form.name,a).then((function(){e.handleGetRoles(),e.createRoleFormVisible=!1,e.clearPermCheck(),s["Message"].success("修改成功")})).catch((function(t){console.log(t),e.clearPermCheck()}))}else s["Message"].error("请输入角色描述");else s["Message"].error("请输入角色名")},handleGetPermissions:function(){var e=this;Object(i["e"])().then((function(t){e.permissions=t.data,e.clearPermCheck()}))},clearPermCheck:function(){var e,t=Object(n["a"])(this.permissions);try{for(t.s();!(e=t.n()).done;){var o=e.value;this.permCheck[o.scope]||(this.permCheck[o.scope]={}),this.permCheck[o.scope][o.object]={get:!1,create:!1,update:!1,delete:!1}}}catch(l){t.e(l)}finally{t.f()}},setPermCheck:function(e){if(console.log(e),this.clearPermCheck(),e.permissions){var t,o=Object(n["a"])(e.permissions);try{for(o.s();!(t=o.n()).done;){var l,r=t.value,a=Object(n["a"])(r.operations);try{for(a.s();!(l=a.n()).done;){var i=l.value;this.permCheck[r.scope][r.object][i]=!0}}catch(s){a.e(s)}finally{a.f()}}}catch(s){o.e(s)}finally{o.f()}}this.form={name:e.name,description:e.description}},deleteRoles:function(e){var t=this;e.length<=0?s["Message"].error("请选择要删除的角色"):Object(i["d"])(e).then((function(e){t.handleGetRoles()})).catch((function(e){console.log(e)}))},nameSearch:function(e){this.search_name=e},createRoleDialog:function(){this.createRoleFormVisible=!0}}},m=c,h=(o("6b4b"),o("2877")),p=Object(h["a"])(m,l,r,!1,null,"88c97158",null);t["default"]=p.exports},"6b4b":function(e,t,o){"use strict";var l=o("0d9f"),r=o.n(l);r.a}}]);
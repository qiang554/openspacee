(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b9ba61e2"],{5043:function(e,t,a){},"96f3":function(e,t,a){"use strict";var i=a("5043"),o=a.n(i);o.a},a15b:function(e,t,a){"use strict";var i=a("23e7"),o=a("44ad"),n=a("fc6a"),r=a("a640"),l=[].join,s=o!=Object,c=r("join",",");i({target:"Array",proto:!0,forced:s||!c},{join:function(e){return l.call(n(this),void 0===e?",":e)}})},adb6:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("clusterbar",{attrs:{titleName:e.titleName,nsFunc:e.nsSearch,nameFunc:e.nameSearch,delFunc:e.delFunc}}),a("div",{staticClass:"dashboard-container"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.networkpolicies,"tooltip-effect":"dark","max-height":e.maxHeight,"cell-style":e.cellStyle,"default-sort":{prop:"name"},"row-key":"uid"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),a("el-table-column",{attrs:{prop:"name",label:"名称","min-width":"30","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"namespace",label:"命名空间","min-width":"30","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"policy_types",label:"策略类型","min-width":"35","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"created",label:"创建时间","min-width":"30","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"","show-overflow-tooltip":"",width:"45"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-dropdown",{attrs:{size:"medium"}},[a("el-link",{attrs:{underline:!1}},[a("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em"},attrs:{"icon-class":"operate"}})],1),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{nativeOn:{click:function(a){return a.preventDefault(),e.getNetworkPolicyYaml(t.row.namespace,t.row.name)}}},[a("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em","line-height":"40px","vertical-align":"-0.25em"},attrs:{"icon-class":"edit"}}),a("span",{staticStyle:{"margin-left":"5px"}},[e._v("修改")])],1),a("el-dropdown-item",{nativeOn:{click:function(a){return a.preventDefault(),e.deleteNetworkPolicies([{namespace:t.row.namespace,name:t.row.name}])}}},[a("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em","line-height":"40px","vertical-align":"-0.25em"},attrs:{"icon-class":"delete"}}),a("span",{staticStyle:{"margin-left":"5px"}},[e._v("删除")])],1)],1)],1)]}}])})],1)],1),a("el-dialog",{attrs:{title:"编辑",visible:e.yamlDialog,"close-on-click-modal":!1,width:"60%",top:"55px"},on:{"update:visible":function(t){e.yamlDialog=t}}},[e.yamlDialog?a("yaml",{attrs:{loading:e.yamlLoading},model:{value:e.yamlValue,callback:function(t){e.yamlValue=t},expression:"yamlValue"}}):e._e(),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{plain:"",size:"small"},on:{click:function(t){e.yamlDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{plain:"",size:"small"},on:{click:function(t){return e.updateNetworkPolicy()}}},[e._v("确 定")])],1)],1)],1)},o=[],n=(a("4de4"),a("caad"),a("c975"),a("a15b"),a("b0c0"),a("2532"),a("b85c")),r=a("61b2"),l=(a("99af"),a("b775"));function s(e){return Object(l["a"])({url:"networkpolicy/".concat(e),method:"get"})}function c(e,t,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return Object(l["a"])({url:"networkpolicy/".concat(e,"/").concat(t,"/").concat(a),method:"get",params:{output:i}})}function u(e,t){return Object(l["a"])({url:"networkpolicy/".concat(e,"/delete"),method:"post",data:t})}function d(e,t,a,i){return Object(l["a"])({url:"networkpolicy/".concat(e,"/update/").concat(t,"/").concat(a),method:"post",data:{yaml:i}})}var h=a("5c96"),m={name:"NetworkPolicy",components:{Clusterbar:r["a"],Yaml:r["f"]},data:function(){return{yamlDialog:!1,yamlNamespace:"",yamlName:"",yamlValue:"",yamlLoading:!0,cellStyle:{border:0},titleName:["Network Policies"],maxHeight:window.innerHeight-150,loading:!0,originNetworkPolicies:[],search_ns:[],search_name:"",delFunc:void 0,delNetworkPolicies:[]}},created:function(){this.fetchData()},mounted:function(){var e=this;window.onresize=function(){return function(){var t=window.innerHeight-150;e.maxHeight=t}()}},watch:{networkpoliciesWatch:function(e){if(e){var t=e.resource.metadata.uid,a=e.resource.metadata.resourceVersion;if("add"===e.event)this.originNetworkPolicies.push(this.buildNetworkPolicies(e.resource));else if("update"===e.event)for(var i in this.originNetworkPolicies){var o=this.originNetworkPolicies[i];if(o.uid===t){if(o.resource_version<a){var n=this.buildNetworkPolicies(e.resource);this.$set(this.originNetworkPolicies,i,n)}break}}else"delete"===e.event&&(this.originNetworkPolicies=this.originNetworkPolicies.filter((function(e){var a=e.uid;return a!==t})))}}},computed:{networkpolicies:function(){var e,t=[],a=Object(n["a"])(this.originNetworkPolicies);try{for(a.s();!(e=a.n()).done;){var i=e.value;this.search_ns.length>0&&this.search_ns.indexOf(i.namespace)<0||(this.search_name&&!i.name.includes(this.search_name)||(i.conditions&&i.conditions.length>0?i.conditions.sort():i.conditions=[],t.push(i)))}}catch(o){a.e(o)}finally{a.f()}return t},networkpoliciesWatch:function(){return this.$store.getters["ws/networkpoliciesWatch"]}},methods:{fetchData:function(){var e=this;this.loading=!0,this.originNetworkPolicies=[];var t=this.$store.state.cluster;t?s(t).then((function(t){e.loading=!1,e.originNetworkPolicies=t.data?t.data:[]})).catch((function(){e.loading=!1})):(this.loading=!1,h["Message"].error("获取集群异常，请刷新重试"))},nsSearch:function(e){this.search_ns=[];var t,a=Object(n["a"])(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;this.search_ns.push(i)}}catch(o){a.e(o)}finally{a.f()}},nameSearch:function(e){this.search_name=e},buildNetworkPolicies:function(e){if(e){var t={uid:e.metadata.uid,namespace:e.metadata.namespace,name:e.metadata.name,policy_types:e.spec.policyTypes,resource_version:e.metadata.resourceVersion,created:e.metadata.creationTimestamp};return t}},nameClick:function(e,t){this.$router.push({name:"networkpolicyDetail",params:{namespace:e,networkpolicyName:t}})},getNetworkPolicyYaml:function(e,t){var a=this;this.yamlNamespace="",this.yamlName="";var i=this.$store.state.cluster;i?e?t?(this.yamlValue="",this.yamlDialog=!0,this.yamlLoading=!0,c(i,e,t,"yaml").then((function(i){a.yamlLoading=!1,a.yamlValue=i.data,a.yamlNamespace=e,a.yamlName=t})).catch((function(){a.yamlLoading=!1}))):h["Message"].error("获取NetworkPolicy名称参数异常，请刷新重试"):h["Message"].error("获取命名空间参数异常，请刷新重试"):h["Message"].error("获取集群参数异常，请刷新重试")},deleteNetworkPolicies:function(e){var t=this.$store.state.cluster;if(t)if(e.length<=0)h["Message"].error("请选择要删除的NetworkPolicies");else{var a={resources:e};u(t,a).then((function(){h["Message"].success("删除成功")})).catch((function(){}))}else h["Message"].error("获取集群参数异常，请刷新重试")},updateNetworkPolicy:function(){var e=this.$store.state.cluster;e?this.yamlNamespace?this.yamlName?(console.log(this.yamlValue),d(e,this.yamlNamespace,this.yamlName,this.yamlValue).then((function(){h["Message"].success("更新成功")})).catch((function(){}))):h["Message"].error("获取NetworkPolicy参数异常，请刷新重试"):h["Message"].error("获取命名空间参数异常，请刷新重试"):h["Message"].error("获取集群参数异常，请刷新重试")},_delNetworkPoliciesFunc:function(){if(this.delNetworkPolicies.length>0){var e,t=[],a=Object(n["a"])(this.delNetworkPolicies);try{for(a.s();!(e=a.n()).done;){var i=e.value;t.push({namespace:i.namespace,name:i.name})}}catch(o){a.e(o)}finally{a.f()}this.deleteNetworkPolicies(t)}},handleSelectionChange:function(e){this.delNetworkPolicies=e,e.length>0?this.delFunc=this._delNetworkPoliciesFunc:this.delFunc=void 0},getPortsDisplay:function(e){if(!e)return"";var t,a=[],i=Object(n["a"])(e);try{for(i.s();!(t=i.n()).done;){var o=t.value,r=o.port;o.nodePort&&(r+=":"+o.nodePort),r+="/"+o.protocol,a.push(r)}}catch(l){i.e(l)}finally{i.f()}return a.join(",")}}},f=m,p=(a("f47b"),a("96f3"),a("2877")),w=Object(p["a"])(f,i,o,!1,null,"448931c6",null);t["default"]=w.exports},e396:function(e,t,a){},f47b:function(e,t,a){"use strict";var i=a("e396"),o=a.n(i);o.a}}]);
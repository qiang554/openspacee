(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ee9b1736"],{"3c17":function(e,n,t){"use strict";var a=t("f8f0"),i=t.n(a);i.a},a15b:function(e,n,t){"use strict";var a=t("23e7"),i=t("44ad"),o=t("fc6a"),s=t("a640"),l=[].join,r=i!=Object,c=s("join",",");a({target:"Array",proto:!0,forced:r||!c},{join:function(e){return l.call(o(this),void 0===e?",":e)}})},a4db:function(e,n,t){"use strict";var a=t("ba4a"),i=t.n(a);i.a},b98a:function(e,n,t){"use strict";t.d(n,"c",(function(){return i})),t.d(n,"b",(function(){return o})),t.d(n,"a",(function(){return s})),t.d(n,"d",(function(){return l}));t("99af");var a=t("b775");function i(e){return Object(a["a"])({url:"rolebinding/".concat(e),method:"get"})}function o(e,n,t,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Object(a["a"])({url:"rolebinding/".concat(e,"/").concat(n,"/").concat(t),method:"get",params:{output:o,kind:i}})}function s(e,n){return Object(a["a"])({url:"rolebinding/".concat(e,"/delete"),method:"post",data:n})}function l(e,n,t,i,o){return Object(a["a"])({url:"rolebinding/".concat(e,"/update/").concat(n,"/").concat(t),method:"post",data:{yaml:o,kind:i}})}},ba4a:function(e,n,t){},e92e:function(e,n,t){"use strict";t.r(n);var a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("clusterbar",{attrs:{titleName:e.titleName,nsFunc:e.nsSearch,nameFunc:e.nameSearch,delFunc:e.delFunc}}),t("div",{staticClass:"dashboard-container"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"table-fix",staticStyle:{width:"100%"},attrs:{data:e.rolebindings,"tooltip-effect":"dark","max-height":e.maxHeight,"cell-style":e.cellStyle,"row-key":"uid"},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"45"}}),t("el-table-column",{attrs:{prop:"name",label:"名称","min-width":"40","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",{staticClass:"name-class",on:{click:function(t){return e.nameClick(n.row.namespace,n.row.name)}}},[e._v(" "+e._s(n.row.name)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"namespace",label:"命名空间","min-width":"25","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{prop:"subjects",label:"绑定主体","min-width":"45","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(n){return[n.row.subjects&&n.row.subjects.length>0?e._l(n.row.subjects,(function(n){return t("span",{key:n.name,staticClass:"back-class"},[e._v(" "+e._s(n.kind+"/"+n.name)+" ")])})):e._e()]}}])}),t("el-table-column",{attrs:{prop:"role",label:"角色","min-width":"35","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",[e._v(" "+e._s(n.row.role.name)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"created",label:"创建时间","min-width":"30","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"","show-overflow-tooltip":"",width:"45"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("el-dropdown",{attrs:{size:"medium"}},[t("el-link",{attrs:{underline:!1}},[t("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em"},attrs:{"icon-class":"operate"}})],1),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{nativeOn:{click:function(t){return t.preventDefault(),e.nameClick(n.row.namespace,n.row.name)}}},[t("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em","line-height":"40px","vertical-align":"-0.25em"},attrs:{"icon-class":"detail"}}),t("span",{staticStyle:{"margin-left":"5px"}},[e._v("详情")])],1),t("el-dropdown-item",{nativeOn:{click:function(t){return t.preventDefault(),e.getRoleBindingYaml(n.row.namespace,n.row.name,n.row.kind)}}},[t("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em","line-height":"40px","vertical-align":"-0.25em"},attrs:{"icon-class":"edit"}}),t("span",{staticStyle:{"margin-left":"5px"}},[e._v("修改")])],1),t("el-dropdown-item",{nativeOn:{click:function(t){return t.preventDefault(),e.deleteRoleBindings([{namespace:n.row.namespace,name:n.row.name}])}}},[t("svg-icon",{staticStyle:{width:"1.3em",height:"1.3em","line-height":"40px","vertical-align":"-0.25em"},attrs:{"icon-class":"delete"}}),t("span",{staticStyle:{"margin-left":"5px"}},[e._v("删除")])],1)],1)],1)]}}])})],1)],1),t("el-dialog",{attrs:{title:"编辑",visible:e.yamlDialog,"close-on-click-modal":!1,width:"60%",top:"55px"},on:{"update:visible":function(n){e.yamlDialog=n}}},[e.yamlDialog?t("yaml",{attrs:{loading:e.yamlLoading},model:{value:e.yamlValue,callback:function(n){e.yamlValue=n},expression:"yamlValue"}}):e._e(),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{plain:"",size:"small"},on:{click:function(n){e.yamlDialog=!1}}},[e._v("取 消")]),t("el-button",{attrs:{plain:"",size:"small"},on:{click:function(n){return e.updateRoleBinding()}}},[e._v("确 定")])],1)],1)],1)},i=[],o=(t("4de4"),t("caad"),t("c975"),t("a15b"),t("b0c0"),t("2532"),t("b85c")),s=t("61b2"),l=t("b98a"),r=t("5c96"),c={name:"RoleBinding",components:{Clusterbar:s["a"],Yaml:s["f"]},data:function(){return{yamlDialog:!1,yamlNamespace:"",yamlName:"",yamlValue:"",yamlKind:"",yamlLoading:!0,cellStyle:{border:0},titleName:["Role Bindings"],maxHeight:window.innerHeight-150,loading:!0,originRoleBindings:[],search_ns:[],search_name:"",delFunc:void 0,delRoleBindings:[]}},created:function(){this.fetchData()},mounted:function(){var e=this;window.onresize=function(){return function(){var n=window.innerHeight-150;e.maxHeight=n}()}},watch:{rolebindingsWatch:function(e){if(e){var n=e.resource.metadata.uid,t=e.resource.metadata.resourceVersion;if("add"===e.event)this.originRoleBindings.push(this.buildRoleBindings(e.resource));else if("update"===e.event)for(var a in this.originRoleBindings){var i=this.originRoleBindings[a];if(i.uid===n){if(i.resource_version<t){var o=this.buildRoleBindings(e.resource);this.$set(this.originRoleBindings,a,o)}break}}else"delete"===e.event&&(this.originRoleBindings=this.originRoleBindings.filter((function(e){var t=e.uid;return t!==n})))}}},computed:{rolebindings:function(){var e,n=[],t=Object(o["a"])(this.originRoleBindings);try{for(t.s();!(e=t.n()).done;){var a=e.value;this.search_ns.length>0&&this.search_ns.indexOf(a.namespace)<0||(this.search_name&&!a.name.includes(this.search_name)||n.push(a))}}catch(i){t.e(i)}finally{t.f()}return n.sort((function(e,n){return e.kind<n.kind||e.name>n.name?1:-1})),n},rolebindingsWatch:function(){return this.$store.getters["ws/rolebindingsWatch"]}},methods:{fetchData:function(){var e=this;this.loading=!0,this.originRoleBindings=[];var n=this.$store.state.cluster;n?Object(l["c"])(n).then((function(n){e.loading=!1,e.originRoleBindings=n.data})).catch((function(){e.loading=!1})):(this.loading=!1,r["Message"].error("获取集群异常，请刷新重试"))},nsSearch:function(e){this.search_ns=[];var n,t=Object(o["a"])(e);try{for(t.s();!(n=t.n()).done;){var a=n.value;this.search_ns.push(a)}}catch(i){t.e(i)}finally{t.f()}},nameSearch:function(e){this.search_name=e},buildRoleBindings:function(e){if(e){var n={uid:e.metadata.uid,namespace:e.metadata.namespace,name:e.metadata.name,subjects:e.subjects,role:e.roleRef,resource_version:e.metadata.resourceVersion,created:e.metadata.creationTimestamp};return n}},nameClick:function(e,n){e?this.$router.push({name:"rolebindingDetail",params:{namespace:e,rolebindingName:n}}):this.$router.push({name:"clusterrolebindingDetail",params:{rolebindingName:n}})},getRoleBindingYaml:function(e,n,t){var a=this;this.yamlNamespace="",this.yamlName="";var i=this.$store.state.cluster;i?t?"RoleBinding"!==t||e?("ClusterRoleBinding"===t&&(e="n"),n?(this.yamlValue="",this.yamlDialog=!0,this.yamlLoading=!0,Object(l["b"])(i,e,n,t,"yaml").then((function(i){a.yamlLoading=!1,a.yamlValue=i.data,a.yamlNamespace=e,a.yamlKind=t,a.yamlName=n})).catch((function(){a.yamlLoading=!1}))):r["Message"].error("获取RoleBinding名称参数异常，请刷新重试")):r["Message"].error("获取命名空间参数异常，请刷新重试"):r["Message"].error("获取RoleBinding参数异常，请刷新重试"):r["Message"].error("获取集群参数异常，请刷新重试")},deleteRoleBindings:function(e){var n=this.$store.state.cluster;if(n)if(e.length<=0)r["Message"].error("请选择要删除的RoleBindings");else{var t={resources:e};Object(l["a"])(n,t).then((function(){r["Message"].success("删除成功")})).catch((function(){}))}else r["Message"].error("获取集群参数异常，请刷新重试")},updateRoleBinding:function(){var e=this.$store.state.cluster;e?this.yamlKind?"RoleBinding"!==this.yamlKind||this.yamlNamespace?("ClusterRoleBinding"===this.yamlKind&&(this.yamlNamespace="n"),this.yamlName?Object(l["d"])(e,this.yamlNamespace,this.yamlName,this.yamlKind,this.yamlValue).then((function(){r["Message"].success("更新成功")})).catch((function(){})):r["Message"].error("获取RoleBinding参数异常，请刷新重试")):r["Message"].error("获取命名空间参数异常，请刷新重试"):r["Message"].error("获取RoleBinding参数异常，请刷新重试"):r["Message"].error("获取集群参数异常，请刷新重试")},_delRoleBindingsFunc:function(){if(this.delRoleBindings.length>0){var e,n=[],t=Object(o["a"])(this.delRoleBindings);try{for(t.s();!(e=t.n()).done;){var a=e.value;n.push({namespace:a.namespace,name:a.name})}}catch(i){t.e(i)}finally{t.f()}this.deleteRoleBindings(n)}},handleSelectionChange:function(e){this.delRoleBindings=e,e.length>0?this.delFunc=this._delRoleBindingsFunc:this.delFunc=void 0},getPortsDisplay:function(e){if(!e)return"";var n,t=[],a=Object(o["a"])(e);try{for(a.s();!(n=a.n()).done;){var i=n.value,s=i.port;i.nodePort&&(s+=":"+i.nodePort),s+="/"+i.protocol,t.push(s)}}catch(l){a.e(l)}finally{a.f()}return t.join(",")}}},d=c,u=(t("3c17"),t("a4db"),t("2877")),m=Object(u["a"])(d,a,i,!1,null,"2c502524",null);n["default"]=m.exports},f8f0:function(e,n,t){}}]);